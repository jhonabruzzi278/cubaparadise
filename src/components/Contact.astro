---
import IconWhatsapp from "./IconWhatsapp.astro";
---

<section id="contacto" aria-labelledby="contacto-title" class="container-fluid py-5">
  <div class="container py-5">
    <div class="text-center mb-5 pb-3">
      <h6 class="text-primary text-uppercase fw-bold" id="contacto-title" style="letter-spacing: 3px;">Contacto</h6>
      <h1 class="display-5 fw-bold">Planifica tu Viaje a Cuba</h1>
      <p class="lead text-muted">Contáctanos para organizar tu experiencia perfecta en Cuba</p>
    </div>
    <div class="row justify-content-center">
      <div class="col-12 col-md-10 col-lg-8 col-xl-6">
        <div class="contact-form bg-white rounded shadow p-3 p-md-4 p-lg-5">
          <div id="success" class="visually-hidden" aria-live="polite"></div>
          <form id="contactForm" novalidate>
            <div class="row g-3">
              <div class="col-12">
                <label for="name" class="form-label fw-bold">Nombre Completo</label>
                <input
                  type="text"
                  class="form-control form-control-lg"
                  id="name"
                  name="name"
                  placeholder="Tu nombre completo"
                  autocomplete="name"
                  minlength="2"
                  maxlength="80"
                  aria-required="true"
                  aria-describedby="nameHelp"
                  required
                />
                <div id="nameHelp" class="form-text text-danger d-none">Por favor, introduce tu nombre (mínimo 2 caracteres).</div>
              </div>
              
                
              <div class="col-12">
                <label for="message" class="form-label fw-bold">Mensaje</label>
                <textarea
                  class="form-control"
                  rows="4"
                  id="message"
                  name="message"
                  placeholder="Cuéntanos sobre tu viaje ideal a Cuba: fechas, destinos de interés, número de personas, presupuesto aproximado, etc."
                  minlength="10"
                  maxlength="1000"
                  aria-required="true"
                  aria-describedby="messageHelp"
                  required></textarea>
                <div id="messageHelp" class="form-text text-danger d-none">Escribe un mensaje (mínimo 10 caracteres).</div>
              </div>
              <div class="col-12 text-center pt-3">
                <button id="sendBtn" class="btn btn-whatsapp btn-lg px-4 py-3 fw-bold w-100" type="submit">
                  <IconWhatsapp class="me-2" style="width: 20px; height: 20px; display: inline-block;" aria-hidden="true" />Enviar por WhatsApp
                </button>
                <p class="text-muted mt-3 mb-0">
                  <small><span class="material-symbols-outlined me-1" style="font-size: 14px;">schedule</span>Respuesta rápida garantizada • <span class="material-symbols-outlined me-1" style="font-size: 14px;">security</span>100% Seguro</small>
                </p>
              </div>
            </div>
          </form>
          <script is:inline>
            document.addEventListener("DOMContentLoaded", () => {
              const form = document.getElementById("contactForm");
              const btn = document.getElementById("sendBtn");
              const phone = "5356851846"; // WhatsApp destino

              if (!form || !btn) return;

              const getEl = (id) => document.getElementById(id);
              const nameEl = getEl("name");
              const subjectEl = getEl("subject");
              const messageEl = getEl("message");
              const nameHelp = getEl("nameHelp");
              const subjectHelp = getEl("subjectHelp");
              const messageHelp = getEl("messageHelp");

              const toggleError = (el, helpEl, show) => {
                if (!el || !helpEl) return;
                helpEl.classList.toggle("d-none", !show);
                el.classList.toggle("is-invalid", show);
                el.setAttribute("aria-invalid", show ? "true" : "false");
              };

              const validate = () => {
                let valid = true;
                const name = (nameEl?.value || "").trim();
                const subject = (subjectEl?.value || "").trim();
                const message = (messageEl?.value || "").trim();

                const nameOk = name.length >= 2;
                toggleError(nameEl, nameHelp, !nameOk);
                valid = valid && nameOk;

                const subjectOk = subject.length > 0;
                toggleError(subjectEl, subjectHelp, !subjectOk);
                valid = valid && subjectOk;

                const messageOk = message.length >= 10;
                toggleError(messageEl, messageHelp, !messageOk);
                valid = valid && messageOk;

                return { valid, name, subject, message };
              };

              [nameEl, subjectEl, messageEl].forEach((el) => {
                el?.addEventListener("input", () => validate());
              });

              form.addEventListener("submit", (event) => {
                event.preventDefault();
                const { valid, name, subject, message } = validate();
                if (!valid) {
                  // Llevar foco al primer inválido
                  if (nameEl?.classList.contains("is-invalid")) nameEl.focus();
                  else if (subjectEl?.classList.contains("is-invalid")) subjectEl.focus();
                  else if (messageEl?.classList.contains("is-invalid")) messageEl.focus();
                  form.reportValidity?.();
                  return false;
                }

                const text = `¡Hola Cuba Paradise! \n\nMi nombre es: ${name}\nTipo de viaje: ${subject}\n\nMensaje:\n${message}\n\nGracias por su atención.`;
                const url = `https://wa.me/${phone}?text=${encodeURIComponent(text)}`;

                btn.setAttribute("disabled", "true");
                btn.classList.add("disabled");
                try {
                  window.open(url, "_blank", "noopener,noreferrer");
                } finally {
                  setTimeout(() => {
                    btn.removeAttribute("disabled");
                    btn.classList.remove("disabled");
                  }, 800);
                }
                return false;
              });
            });
          </script>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  /* Detalles visuales profesionales conservando el layout */
  .contact-form {
    border: 1px solid rgba(0,0,0,0.05);
  }
  .form-control, .form-select {
    border-radius: 0.75rem;
    border-color: #e5e7eb;
    padding: 0.9rem 1rem;
  }
  .form-control:focus, .form-select:focus {
    border-color: #2563eb;
    box-shadow: 0 0 0 0.2rem rgba(37, 99, 235, 0.15);
  }
  .is-invalid {
    border-color: #dc3545 !important;
  }
  .form-text.text-danger { font-size: 0.85rem; }

  .btn-whatsapp {
    background: #25D366;
    border: none;
    max-width: 420px;
    margin-inline: auto;
    color: #0b3d2e;
    transition: transform .15s ease, box-shadow .2s ease, filter .2s ease;
  }
  .btn-whatsapp:hover { filter: brightness(0.95); transform: translateY(-1px); box-shadow: 0 8px 20px rgba(37, 211, 102, 0.25); }
  .btn-whatsapp:active { transform: translateY(0); box-shadow: none; }
  .btn-whatsapp.disabled, .btn-whatsapp[disabled] { opacity: .7; cursor: not-allowed; }

  /* Tipografías fluidas para títulos y lead */
  #contacto h1 { font-size: clamp(1.6rem, 4.5vw, 2.5rem); line-height: 1.2; }
  #contacto .lead { font-size: clamp(0.95rem, 2.5vw, 1.125rem); }

  /* Tablet */
  @media (max-width: 992px) {
    #contacto { padding-top: 3rem !important; padding-bottom: 3rem !important; }
    #contacto .container { padding-left: 1rem !important; padding-right: 1rem !important; }
    #contacto .text-center { margin-bottom: 2rem !important; }
    #contacto .contact-form { padding: 1.25rem 1rem !important; }
    #contacto .form-control, #contacto .form-select { padding: 0.85rem 0.95rem; }
    #contacto .btn-whatsapp.btn-lg { padding: 0.95rem 1.1rem !important; font-size: 1.05rem; }
  }

  /* Móvil */
  @media (max-width: 768px) {
    #contacto h1 { font-size: 1.55rem; }
    #contacto .lead { font-size: 0.95rem; }
    #contacto .text-center { margin-bottom: 1.5rem !important; }
    #contacto .contact-form { padding: 1rem !important; }
    #contacto .form-control, #contacto .form-select { padding: 0.8rem 0.9rem; font-size: 1rem; border-radius: 0.65rem; }
    #contacto .btn-whatsapp.btn-lg { padding: 0.85rem 1rem !important; font-size: 1rem; }
  }

  /* Móvil pequeño */
  @media (max-width: 480px) {
    #contacto h1 { font-size: 1.45rem; }
    #contacto .lead { font-size: 0.92rem; }
    #contacto .btn-whatsapp.btn-lg { padding: 0.8rem 0.95rem !important; font-size: 0.98rem; }
  }
</style>
