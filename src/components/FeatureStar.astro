---
// Importar las colecciones de contenido
import { getCollection } from 'astro:content';

// Obtener los elementos destacados de cada categoría
const allAlojamiento = await getCollection('alojamiento');
const allTours = await getCollection('tours');
const allExcursiones = await getCollection('excursiones');
const allServicios = await getCollection('servicios');

const featuredAlojamiento = allAlojamiento.find(item => item.data.destacado) || allAlojamiento[0];
const featuredTour = allTours.find(item => item.data.destacado) || allTours[0];
const featuredExcursion = allExcursiones.find(item => item.data.destacado) || allExcursiones[0];
const featuredService = allServicios.find(item => item.data.destacado) || allServicios[0];

// Funciones auxiliares para construir URLs
function getAlojamientoUrl(entry: any) {
    const parts = entry.id.split('/');
    if (parts.length >= 2) {
        return `/alojamiento/${parts[0]}/${parts[1].replace('.md', '')}`;
    }
    return `/alojamiento/${entry.slug || entry.id.replace('.md', '')}`;
}

function getToursUrl(entry: any) {
    const parts = entry.id.split('/');
    if (parts.length >= 2) {
        return `/tours/${parts[0]}/${parts[1].replace('.md', '')}`;
    }
    return `/tours/${entry.slug || entry.id.replace('.md', '')}`;
}

function getExcursionesUrl(entry: any) {
    const parts = entry.id.split('/');
    if (parts.length >= 2) {
        return `/excursiones/${parts[0]}/${parts[1].replace('.md', '')}`;
    }
    return `/excursiones/${entry.slug || entry.id.replace('.md', '')}`;
}

function getServiciosUrl(entry: any) {
    return `/servicios`;
}
---

<div class="container-fluid py-5 bg-light">
    <div class="container pt-5 pb-3">
        <div class="text-center mb-5 pb-3">
            <h6 class="text-primary text-uppercase fw-bold" style="letter-spacing: 5px;">Lo Más Destacado</h6>
            <h1 class="display-5 fw-bold">Experiencias Premium en Cuba</h1>
            <p class="lead text-muted">Descubre nuestras mejores recomendaciones seleccionadas especialmente para ti</p>
        </div>

        
        <div class="bento-grid">
            
            {featuredAlojamiento && (
                <div class="bento-item div1">
                    <div class="bento-card h-100">
                        <div class="bento-image-container">
                            <img src={featuredAlojamiento.data.img} alt={featuredAlojamiento.data.title} class="bento-image">
                        </div>
                        <div class="bento-content">
                            <h3 class="bento-title">{featuredAlojamiento.data.title}</h3>
                            <p class="bento-description">{featuredAlojamiento.data.descripcion || "Disfruta de un alojamiento único en Cuba con todas las comodidades que necesitas."}</p>
                            
                            <div class="bento-buttons">
                                <span class="bento-category-btn bg-primary">Alojamiento</span>
                                <a href={getAlojamientoUrl(featuredAlojamiento)} class="bento-details-btn">Detalles</a>
                            </div>
                        </div>
                    </div>
                </div>
            )}

            
            {featuredTour && (
                <div class="bento-item div2">
                    <div class="bento-card h-100">
                        <div class="bento-image-container">
                            <img src={featuredTour.data.img} alt={featuredTour.data.title} class="bento-image">
                        </div>
                        <div class="bento-content">
                            <h4 class="bento-title">{featuredTour.data.title}</h4>
                            <p class="bento-description">{featuredTour.data.descripcion || "Descubre Cuba con este tour especialmente diseñado para ofrecerte una experiencia auténtica."}</p>
                            
                            <div class="bento-buttons">
                                <span class="bento-category-btn bg-primary">Tour</span>
                                <a href={getToursUrl(featuredTour)} class="bento-details-btn">Detalles</a>
                            </div>
                        </div>
                    </div>
                </div>
            )}

            
            {featuredExcursion && (
                <div class="bento-item div3">
                    <div class="bento-card h-100">
                        <div class="bento-image-container">
                            <img src={featuredExcursion.data.img} alt={featuredExcursion.data.title} class="bento-image">
                        </div>
                        <div class="bento-content">
                            <h4 class="bento-title">{featuredExcursion.data.title}</h4>
                            <p class="bento-description">{featuredExcursion.data.descripcion || "Una excursión perfectamente organizada para descubrir los tesoros naturales de Cuba."}</p>
                            
                            <div class="bento-buttons">
                                <span class="bento-category-btn bg-primary">Excursión</span>
                                <a href={getExcursionesUrl(featuredExcursion)} class="bento-details-btn">Detalles</a>
                            </div>
                        </div>
                    </div>
                </div>
            )}

            
            {featuredService && (
                <div class="bento-item div4">
                    <div class="bento-card h-100">
                        <div class="bento-image-container">
                            <img src={featuredService.data.img} alt={featuredService.data.title} class="bento-image">
                        </div>
                        <div class="bento-content">
                            <h5 class="bento-title">{featuredService.data.title}</h5>
                            <p class="bento-description">{featuredService.data.descripcion || "Servicio especializado para hacer tu experiencia en Cuba más cómoda y completa."}</p>
                            
                            <div class="bento-buttons">
                                <span class="bento-category-btn bg-primary">Servicio</span>
                                <a href={getServiciosUrl(featuredService)} class="bento-details-btn">Detalles</a>
                            </div>
                        </div>
                    </div>
                </div>
            )}
        </div>
    </div>
</div>

<style>
    /* Grid Layout Simple */
    .bento-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: 1fr;
        grid-column-gap: 1.5rem;
        grid-row-gap: 0px;
        max-width: 1200px;
        margin: 0 auto;
        min-height: 380px;
    }

    /* Grid Item Positions */
    .div1 { grid-area: 1 / 1 / 2 / 2; }
    .div2 { grid-area: 1 / 2 / 2 / 3; }
    .div3 { grid-area: 1 / 3 / 2 / 4; }
    .div4 { grid-area: 1 / 4 / 2 / 5; }

    /* Bento Card Base */
    .bento-card {
        position: relative;
        background: white;
        border-radius: 24px;
        overflow: hidden;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        cursor: pointer;
    }

    .bento-card:hover {
        transform: translateY(-12px) scale(1.02);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
    }

    /* Image Container */
    .bento-image-container {
        position: relative;
        height: 50%;
        overflow: hidden;
        border-radius: 24px 24px 0 0;
    }

    .bento-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.6s ease;
    }

    .bento-card:hover .bento-image {
        transform: scale(1.1);
    }

    /* Content Area */
    .bento-content {
        padding: 1.2rem;
        height: 50%;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        gap: 0.5rem;
    }

    /* Typography */
    .bento-title {
        font-weight: 700;
        color: #1a1a1a;
        margin: 0 0 0.6rem 0;
        line-height: 1.2;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        font-size: 1.1rem;
        letter-spacing: -0.01em;
    }

    .bento-description {
        color: #666;
        font-size: 0.85rem;
        line-height: 1.4;
        margin: 0 0 1rem 0;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        flex-grow: 1;
    }

    /* Buttons Section (Minimal) */
    .bento-buttons {
        display: flex;
        align-items: stretch;
        gap: 0.75rem;
        margin-top: auto;
        padding-top: 0.25rem;
        width: 100%;
    }

    /* Category chip */
    .bento-category-btn {
        color: #0f172a;
        background-color: #f8fafc;
        padding: 0.5rem 0.9rem;
        border-radius: 999px;
        font-size: 0.78rem;
        font-weight: 600;
        letter-spacing: 0.3px;
        text-transform: none;
        border: 1px solid #e2e8f0;
        flex: 1 1 0;
        text-align: center;
    }

    .bento-category-btn:hover {
        background-color: #f1f5f9;
    }

    /* Primary full-width button */
    .bento-details-btn {
        background: #f1f5f9; /* slate-100 */
        color: #0f172a; /* slate-900 */
        padding: 0.5rem 0.9rem;
        border-radius: 999px;
        text-decoration: none;
        font-size: 0.78rem;
        font-weight: 600;
        transition: background-color 0.2s ease, transform 0.15s ease, box-shadow 0.2s ease, border-color 0.2s ease;
        cursor: pointer;
        text-align: center;
        border: 1px solid #e2e8f0; /* slate-200 */
        box-shadow: 0 1px 2px rgba(15, 23, 42, 0.04);
        flex: 1 1 0;
    }

    .bento-details-btn:hover {
        background: #e2e8f0; /* slate-200 */
        color: #0f172a;
        border-color: #cbd5e1; /* slate-300 */
        transform: translateY(-1px);
        box-shadow: 0 6px 12px rgba(15, 23, 42, 0.10);
        text-decoration: none;
    }



    /* Link Overlay */
    .bento-link {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 10;
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
        .bento-grid {
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(2, 1fr);
            grid-row-gap: 1.5rem;
            min-height: 340px;
        }

        .div1 { grid-area: 1 / 1 / 2 / 2; }
        .div2 { grid-area: 1 / 2 / 2 / 3; }
        .div3 { grid-area: 2 / 1 / 3 / 2; }
        .div4 { grid-area: 2 / 2 / 3 / 3; }

        .bento-content {
            padding: 1rem;
        }

        .bento-title {
            font-size: 1rem;
        }

        .bento-buttons {
            gap: 0.75rem;
            padding-top: 0.25rem;
        }

        .bento-category-btn,
        .bento-details-btn {
            font-size: 0.74rem;
            padding: 0.5rem 0.9rem;
        }
    }

    @media (max-width: 768px) {
        .bento-grid {
            grid-template-columns: 1fr;
            grid-template-rows: repeat(4, 1fr);
            grid-row-gap: 1rem;
            grid-column-gap: 0;
            min-height: 320px;
        }

        .div1 { grid-area: 1 / 1 / 2 / 2; }
        .div2 { grid-area: 2 / 1 / 3 / 2; }
        .div3 { grid-area: 3 / 1 / 4 / 2; }
        .div4 { grid-area: 4 / 1 / 5 / 2; }

        .bento-content {
            padding: 1rem;
            gap: 0.4rem;
        }

        .bento-title {
            font-size: 1rem !important;
            margin-bottom: 0.5rem !important;
            -webkit-line-clamp: 1;
        }

        .bento-description {
            font-size: 0.8rem !important;
            margin-bottom: 0.6rem !important;
            -webkit-line-clamp: 2;
        }

        .bento-buttons {
            gap: 0.6rem;
            padding-top: 0.2rem;
        }

        .bento-category-btn,
        .bento-details-btn {
            font-size: 0.74rem;
            padding: 0.48rem 0.85rem;
        }
    }

    /* Animations */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .bento-item {
        animation: fadeInUp 0.6s ease forwards;
    }

    .bento-item:nth-child(1) {
        animation-delay: 0.1s;
    }

    .bento-item:nth-child(2) {
        animation-delay: 0.2s;
    }

    .bento-item:nth-child(3) {
        animation-delay: 0.3s;
    }

    .bento-item:nth-child(4) {
        animation-delay: 0.4s;
    }

    /* Loading state */
    @keyframes shimmer {
        0% {
            background-position: -468px 0;
        }
        100% {
            background-position: 468px 0;
        }
    }

    .bento-card.loading {
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 400% 100%;
        animation: shimmer 1.2s ease-in-out infinite;
    }
</style>